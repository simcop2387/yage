
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta content="text/javascript" http-equiv="content-script-type" />
	<title>yage.system.graphics.api.opengl</title>
	<link rel="stylesheet" type="text/css" href="css/default.css" />
	<link rel="stylesheet" type="text/css" href="css/candydoc.css" />
	<link rel="stylesheet" type="text/css" href="css/menu.css" />
	<script type="text/javascript" src="js/util.js"></script>
	<script type="text/javascript" src="js/tree.js"></script>
	<script type="text/javascript" src="js/explorer.js"></script>
  </head>
  <body>
	<!-- Title Image -->	
	<div style="position: absolute; z-index: 2;">
		<a href="http://yage3d.net"><img src="img/title.png" alt="Yage3D.net" border="0"></a>
	</div>
	
	<!-- Menu -->
	<div style="position: absolute;	height: 87px; width: 100%">
		<div style="margin-top: 63px">
		<div id="slidetabsmenu">
			<ul>
			<li><a href="http://yage3d.net" title="Yage Home"><span>Home</span></a></li>
			<li><a href="http://yage3d.net/wiki" title="Yage Wiki"><span>Wiki</span></a></li>
			<li><a href="http://dsource.org/forums/viewforum.php?f=110" title="Yage Forum"><span>Forum</span></a></li>
			<li><a href="index.html" title="Yage API Documentation"><span>API</span></a></li>
			</ul>
		</div>
		</div>
	</div>
	
	 <!-- Images at top of page -->
	<table cellpadding="0" cellspacing="0" width="100%">
		<!-- Upper part -->
		<tr>
			<td width="75%" style="background: url('img/title-stretch.png') repeat-x">&nbsp;</td>
			<td style="background: url('img/title-right-stretch.png') repeat-x">
				<img src="img/title-right.png" alt="" height="102" style="vertical-align: top;"></td>
			<td width="25%" valign="top" style="background: url('img/title-right-stretch.png') repeat-x">
				<img src="img/title-right-gear.png" style="float: right;" alt="">
			</td>
		</tr>
		
		<tr> <!-- Bar Beneath Main title -->
			<td width="100%" colspan="4">
			
			
	
				<table cellpadding="0" cellspacing="0" width="100%">
					<tr>
						<td width="100%" style="background: url('img/bar-stretch.png') repeat-x; height: 9px;"></td>
						<td valign="top"><img src="img/search.png" alt="" style="vertical-align: top"></td>
						<td style="background: url('img/search-stretch.png') repeat-x;">
							<!-- Use Google search for now -->				
							<form method="GET" action="http://www.google.com/search" style="padding: 2px">
								<input type="hidden" name="ie" value="UTF-8">
								<input type="hidden" name="oe" value="UTF-8">
								<input type="hidden" name="domains" value="www.yage3d.net">
								<input type="hidden" name="sitesearch" value="svn.dsource.org/projects/yage/trunk/doc/">
								<input type="text" name="q" value="" style="height: 1.1em; width: 200px"><span>
								<input type="submit" name="btnG" value="API Search" style="width: 90px"></span>
							</form>
							<div style="width: 320px; height: 1px;"></div>
						</td>
					</tr>
				</table>
			</td>
		</tr>
	</table>
	
	<!-- Content -->
	<table cellpadding="6">
	  <tr>
		<td valign="top">
		  <div id="tabarea"></div>
		  <div id="explorerclient"></div>  
		</td>
		<td valign="top" width="100%">	  
			<div id="content"><script type="text/javascript">explorer.initialize("yage.system.graphics.api.opengl");</script>
				<table class="content" width="100%">
					<tr><td id="docbody"><h1>yage.system.graphics.api.opengl</h1><!-- Generated by Ddoc from yage\system\graphics\api\opengl.d -->
<b>Authors:</b><br>
Eric Poggel
<br><br>
<b>License:</b><br>
<a href="lgpl3.txt">LGPL v3</a>
 
<br><br>


<script type="text/javascript">explorer.outline.incSymbolLevel();</script>
<dl>
<script type="text/javascript">explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">class 
<span class="currsymbol">OpenGL</span>
<script type="text/javascript">explorer.outline.addDecl('OpenGL');</script>
: yage.system.graphics.api.api.GraphicsAPI;
</span></dt>
<script type="text/javascript">explorer.outline.writeEnabled = false;</script>

<dd>The 
<span class="currsymbol">OpenGL</span>
<script type="text/javascript">explorer.outline.addDecl('OpenGL');</script>
 class provides a higher level of abstraction over 
<span class="currsymbol">OpenGL</span>
<script type="text/javascript">explorer.outline.addDecl('OpenGL');</script>
,
 without limiting what can be done with low-level 
<span class="currsymbol">OpenGL</span>
<script type="text/javascript">explorer.outline.addDecl('OpenGL');</script>
 calls.
 By inherting GraphicsAPI, it can be used interchangeably with other graphics apis,
 should they ever be implemented.
 
<br><br>


<script type="text/javascript">explorer.outline.incSymbolLevel();</script>
<dl>
<script type="text/javascript">explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">this();
</span></dt>
<script type="text/javascript">explorer.outline.writeEnabled = false;</script>

<dd><br><br>
</dd>

<script type="text/javascript">explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">bindCamera</span>
<script type="text/javascript">explorer.outline.addDecl('bindCamera');</script>
(CameraNode <span class="funcparam">camera</span>, int <span class="funcparam">width</span>, int <span class="funcparam">height</span>);
</span></dt>
<script type="text/javascript">explorer.outline.writeEnabled = false;</script>

<dd><br><br>
</dd>

<script type="text/javascript">explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">bindLight</span>
<script type="text/javascript">explorer.outline.addDecl('bindLight');</script>
(LightNode <span class="funcparam">light</span>, int <span class="funcparam">num</span>);
</span></dt>
<script type="text/javascript">explorer.outline.writeEnabled = false;</script>

<dd>Set all of the OpenGL states to the values of this material layer.
<br><br>
<b>Params:</b><br>
<table><tr>
<td nowrap valign="top" style="padding-right: 8px">lights</td>

               
<td>An array containing the LightNodes that affect this material,
     passed to the shader through uniform variables (unfinished).
     This function is used internally by the engine and doesn't normally need to be called.</td></tr>
<tr>
<td nowrap valign="top" style="padding-right: 8px">color</td>

               
<td>Used to set color on a per-instance basis, combined with existing material colors.</td></tr>
<tr>
<td nowrap valign="top" style="padding-right: 8px">Model</td>

               
<td>Used to retrieve texture coordinates for multitexturing.
	void bindLayer(Layer layer, LightNode[] lights = null
, Color color = Color("white"), Geometry model=null
)
	{
		if (layer)
		{	// Material
			glMaterialfv(GL_FRONT, GL_AMBIENT, layer.ambient.vec4f.scale(color.vec4f).v.ptr);
			glMaterialfv(GL_FRONT, GL_DIFFUSE, layer.diffuse.vec4f.scale(color.vec4f).v.ptr);
			glMaterialfv(GL_FRONT, GL_SPECULAR, layer.specular.vec4f.scale(color.vec4f).v.ptr);
			glMaterialfv(GL_FRONT, GL_EMISSION, layer.emissive.vec4f.scale(color.vec4f).v.ptr);
			glMaterialfv(GL_FRONT, GL_SHININESS, &layer.specularity);
<br><br>

			glColor4fv(layer.color.vec4f.ptr);
<br><br>

			// Blend
			if (layer.blend != BLEND_NONE)
			{	glEnable(GL_BLEND);
				glDepthMask(false
);
				switch (layer.blend)
				{	case BLEND_ADD:
						glBlendFunc(GL_ONE, GL_ONE);
						break;
					case BLEND_AVERAGE:
						glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
						break;
					case BLEND_MULTIPLY:
						glBlendFunc(GL_ZERO, GL_SRC_COLOR);
						break;</td></tr>
</table><br>
<b>default:</b><br>
break;
			}	}
			else
			{	glEnable(GL_ALPHA_TEST);
				glAlphaFunc(GL_GREATER, 0.5f); // If blending is disabled, any pixel less than 0.5 opacity will not be drawn
			}
<br><br>

			// Cull
			if (layer.cull == LAYER_CULL_FRONT)
				glCullFace(GL_FRONT);
<br><br>

			// Polygon
			switch (layer.draw)
			{	default:
				case LAYER_DRAW_FILL:
					glPolygonMode(GL_FRONT_AND_BACK, GL_FILL);
					break;
				case LAYER_DRAW_LINES:
					glPolygonMode(GL_FRONT_AND_BACK, GL_LINE);
					glLineWidth(layer.width);
					break;
				case LAYER_DRAW_POINTS:
					glPolygonMode(GL_FRONT_AND_BACK, GL_POINT);
					glPointSize(layer.width);
					break;
			}
<br><br>

			// Textures
			if (layer.textures.length&gt;1 &amp;&amp; Probe.feature(Probe.Feature.MULTITEXTURE))
			{	int length = min(layer.textures.length, Probe.feature(Probe.Feature.MAX_TEXTURE_UNITS));
<br><br>

				// Loop through all of Layer's textures up to the maximum allowed.
				// TODO: there's currently no coverage for this block
				for (int i=0; i<length; i++)
				{	int GL_TEXTUREI_ARB = GL_TEXTURE0_ARB+i;

					// Activate texture unit and enable texturing
					glActiveTextureARB(GL_TEXTUREI_ARB);
					glEnable(GL_TEXTURE_2D);
					glClientActiveTextureARB(GL_TEXTUREI_ARB);

					// TODO: bind closest level of texture coordinates available instead of always using 0.
					bindVertexBuffer(model.getVertexBuffer(Geometry.TEXCOORDS0), Geometry.TEXCOORDS0);
					bindTexture(layer.textures[i]);
				}
			}
			else if(layer.textures.length == 1){
				glEnable(GL_TEXTURE_2D);
				bindTexture(layer.textures[0]);
			} else
				glDisable(GL_TEXTURE_2D);


			if (layer.shader)
			{
				ShaderUniform[3] uniforms;
				uniforms[0] = ShaderUniform("light_number", ShaderUniform.Type.F1, cast(float)lights.length);
				uniforms[1] = ShaderUniform("fog_enabled", ShaderUniform.Type.F1, cast(float)current.camera.getScene().fogEnabled);


				// int uniforms = glGetObjectParameterivARB(GL_ACTIVE_UNIFORMS);

				// Bind Textures to UniformSampler2D
				// TODO: Use glGetActiveUniform to get user defined uniforms that are sampler2D and automatically bind textures in order
				// keep in mind 1d, 3d, cupe, and shadow textures
				for (int i=0; i<layer.textures.length; i++)
				{
					if (layer.textures[i].name.length)
					{	char[256] cname = 0;
						cname[0..layer.textures[i].name.length]= layer.textures[i].name;
						int location = glGetUniformLocationARB(layer.program, cname.ptr);
						if (location == -1)
						{}//	throw new Exception("Warning:  Unable to set texture sampler: " ~ textures[i].name);
						else
							glUniform1iARB(location, i);
				}	}


				bindShader(layer.shader, layer, uniforms);
			}
		} else // unbind
		{
			glColor4f(1, 1, 1, 1);

			// Material
			float s=0;
			glMaterialfv(GL_FRONT, GL_AMBIENT, Vec4f().v.ptr);
			glMaterialfv(GL_FRONT, GL_DIFFUSE, Vec4f(1).v.ptr);
			glMaterialfv(GL_FRONT, GL_SPECULAR, Vec4f().v.ptr);
			glMaterialfv(GL_FRONT, GL_EMISSION, Vec4f().v.ptr);
			glMaterialfv(GL_FRONT, GL_SHININESS, &s);

			// Blend
			if (current.layer.blend != BLEND_NONE)
			{	glDisable(GL_BLEND);
				glDepthMask(true);
			}else
			{	glDisable(GL_ALPHA_TEST);
				glAlphaFunc(GL_ALWAYS, 0);
			}

			// Cull, polygon
			glCullFace(GL_BACK);
			glPolygonMode(GL_FRONT_AND_BACK, GL_FILL);


			// Textures
			if (current.layer.textures.length>1 &amp;&amp; Probe.feature(Probe.Feature.VBO))
			{	int length = min(layer.textures.length, Probe.feature(Probe.Feature.MAX_TEXTURE_UNITS));
<br><br>

				for (int i=length-1; i&gt;=0; i--)
				{	glActiveTextureARB(GL_TEXTURE0_ARB+i);
					glDisable(GL_TEXTURE_2D);
<br><br>

					if (layer.textures[i].reflective)
					{	glDisable(GL_TEXTURE_GEN_S);
						glDisable(GL_TEXTURE_GEN_T);
					}
					glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
					textureUnbind(layer.textures[i]);
				}
				glClientActiveTextureARB(GL_TEXTURE0_ARB);
			}
			else if(current.layer.textures.length == 1){
				textureUnbind(current.layer.textures[0]);
				//glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE);
			}
			glDisable(GL_TEXTURE_2D);
<br><br>

			bindShader(null
, null
);
		}
		current.layer = layer;
	}
	
<br><br>

 Enable this <span class="funcparam">light</span> as the given <span class="funcparam">light</span> number and apply its properties.
 This function is used internally by the engine and should not be called manually or exported. 
<br><br>

</dd>

<script type="text/javascript">explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">bindRenderTarget</span>
<script type="text/javascript">explorer.outline.addDecl('bindRenderTarget');</script>
(IRenderTarget <span class="funcparam">target</span>);
</span></dt>
<script type="text/javascript">explorer.outline.writeEnabled = false;</script>

<dd>Call this function twice, the first time with a render <span class="funcparam">target</span>, and then again with null
 to complete.
 TODO, allow specifying which buffers to draw to (color, depth, stencil, etc).
<br><br>
<b>Params:</b><br>
<table><tr>
<td nowrap valign="top" style="padding-right: 8px">IRenderTarget <span class="funcparam">target</span></td>

               
<td>Render to this <span class="funcparam">target</span></td></tr>
</table><br>

</dd>

<script type="text/javascript">explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">bindScene</span>
<script type="text/javascript">explorer.outline.addDecl('bindScene');</script>
(Scene <span class="funcparam">scene</span>);
</span></dt>
<script type="text/javascript">explorer.outline.writeEnabled = false;</script>

<dd>Bind global <span class="funcparam">scene</span> properties, like ambient light and fog.
<br><br>
<b>Params:</b><br>
<table><tr>
<td nowrap valign="top" style="padding-right: 8px">Scene <span class="funcparam">scene</span></td>

               
<td>If non null
, bind the properties of this <span class="funcparam">scene</span>, otherwise set them back to the defalts. </td></tr>
</table><br>

</dd>

<script type="text/javascript">explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">bindShader</span>
<script type="text/javascript">explorer.outline.addDecl('bindShader');</script>
(Shader <span class="funcparam">shader</span>, ShaderUniform[] <span class="funcparam">variables</span> = null);
</span></dt>
<script type="text/javascript">explorer.outline.writeEnabled = false;</script>

<dd><b>TODO:</b><br>
Allow specifying uniform variable assignments.
<br><br>

</dd>

<script type="text/javascript">explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">bindTexture</span>
<script type="text/javascript">explorer.outline.addDecl('bindTexture');</script>
(ref Texture <span class="funcparam">texture</span>);
</span></dt>
<script type="text/javascript">explorer.outline.writeEnabled = false;</script>

<dd><br><br>
</dd>

<script type="text/javascript">explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">textureUnbind</span>
<script type="text/javascript">explorer.outline.addDecl('textureUnbind');</script>
(Texture <span class="funcparam">texture</span>);
</span></dt>
<script type="text/javascript">explorer.outline.writeEnabled = false;</script>

<dd><b>TODO:</b><br>
merge into bindTexture
<br><br>

</dd>

<script type="text/javascript">explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">bindVertexBuffer</span>
<script type="text/javascript">explorer.outline.addDecl('bindVertexBuffer');</script>
(VertexBuffer <span class="funcparam">vb</span>, char[] <span class="funcparam">type</span> = "");
</span></dt>
<script type="text/javascript">explorer.outline.writeEnabled = false;</script>

<dd>Bind (and if necessary upload to video memory) a vertex buffer
<br><br>
<b>Params:</b><br>
<table><tr>
<td nowrap valign="top" style="padding-right: 8px">char[] <span class="funcparam">type</span></td>

               
<td>A vertex buffer <span class="funcparam">type</span> constant defined in Geometry or Mesh. </td></tr>
</table><br>

</dd>

<script type="text/javascript">explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">cleanup</span>
<script type="text/javascript">explorer.outline.addDecl('cleanup');</script>
(uint <span class="funcparam">age</span> = cast(uint)3600);
</span></dt>
<script type="text/javascript">explorer.outline.writeEnabled = false;</script>

<dd>Free any resources from graphics memory are either:
 - haven't been used for longer than <span class="funcparam">age</span>,
 - are no longer referenced.
 If removed from graphics memory, they will be re-uploaded when needed again.
<br><br>
<b>Params:</b><br>
<table><tr>
<td nowrap valign="top" style="padding-right: 8px">uint <span class="funcparam">age</span></td>

               
<td>maximum <span class="funcparam">age</span> (in seconds) of objects to keep.  Set to 0 to remove all items.  Defaults to 3600.</td></tr>
</table><br>

</dd>

<script type="text/javascript">explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">RenderStatistics 
<span class="currsymbol">drawGeometry</span>
<script type="text/javascript">explorer.outline.addDecl('drawGeometry');</script>
(Geometry <span class="funcparam">geometry</span>);
</span></dt>
<script type="text/javascript">explorer.outline.writeEnabled = false;</script>

<dd><br><br>
</dd>

<script type="text/javascript">explorer.outline.writeEnabled = true;</script>
<dt><span class="decl">void 
<span class="currsymbol">drawVertexBuffer</span>
<script type="text/javascript">explorer.outline.addDecl('drawVertexBuffer');</script>
(VertexBuffer <span class="funcparam">polygons</span>, char[] <span class="funcparam">type</span>);
</span></dt>
<script type="text/javascript">explorer.outline.writeEnabled = false;</script>

<dd>Draw the contents of a vertex buffer, such as a buffer of triangle indices.
 @param triangles If not null
, this array of triangle indices will be used for drawing the mesh
<br><br>

</dd>
</dl>
<script type="text/javascript">explorer.outline.decSymbolLevel();</script>


</dd>
</dl>
<script type="text/javascript">explorer.outline.decSymbolLevel();</script>


</td></tr>
				</table>
			</div>
		</td>  
	  </tr>
	</table>
	<div id="docfooter">
		Yage and all source files &copy; 2005-2009 Eric Poggel<br>
		Documentation generated with <a href="http://www.dsource.org/projects/helix/wiki/CandyDoc">
		<img src="img/candydoc.gif" alt="CandyDoc" style="vertical-align:middle; top:-1px"></a>
		on Thu Apr  8 00:06:44 2010

	</div>
	
	<script type="text/javascript">
	explorer.packageExplorer.addModule("demo1.gameobj");

	explorer.packageExplorer.addModule("demo1.main");

	explorer.packageExplorer.addModule("demo1.ship");

	explorer.packageExplorer.addModule("demo1.spring");

	explorer.packageExplorer.addModule("yage.all");

	explorer.packageExplorer.addModule("yage.core.all");

	explorer.packageExplorer.addModule("yage.core.array");

	explorer.packageExplorer.addModule("yage.core.cache");

	explorer.packageExplorer.addModule("yage.core.color");

	explorer.packageExplorer.addModule("yage.core.format");

	explorer.packageExplorer.addModule("yage.core.json");

	explorer.packageExplorer.addModule("yage.core.math.all");

	explorer.packageExplorer.addModule("yage.core.math.math");

	explorer.packageExplorer.addModule("yage.core.math.matrix");

	explorer.packageExplorer.addModule("yage.core.math.plane");

	explorer.packageExplorer.addModule("yage.core.math.quatrn");

	explorer.packageExplorer.addModule("yage.core.math.vector");

	explorer.packageExplorer.addModule("yage.core.memory");

	explorer.packageExplorer.addModule("yage.core.misc");

	explorer.packageExplorer.addModule("yage.core.object2");

	explorer.packageExplorer.addModule("yage.core.parse");

	explorer.packageExplorer.addModule("yage.core.repeater");

	explorer.packageExplorer.addModule("yage.core.timer");

	explorer.packageExplorer.addModule("yage.core.tree");

	explorer.packageExplorer.addModule("yage.core.types");

	explorer.packageExplorer.addModule("yage.gui.all");

	explorer.packageExplorer.addModule("yage.gui.exceptions");

	explorer.packageExplorer.addModule("yage.gui.style");

	explorer.packageExplorer.addModule("yage.gui.surface");

	explorer.packageExplorer.addModule("yage.gui.surfacegeometry");

	explorer.packageExplorer.addModule("yage.gui.textlayout");

	explorer.packageExplorer.addModule("yage.resource.all");

	explorer.packageExplorer.addModule("yage.resource.collada");

	explorer.packageExplorer.addModule("yage.resource.embed.juras_medium_ascii_ttf");

	explorer.packageExplorer.addModule("yage.resource.font");

	explorer.packageExplorer.addModule("yage.resource.geometry");

	explorer.packageExplorer.addModule("yage.resource.image");

	explorer.packageExplorer.addModule("yage.resource.manager");

	explorer.packageExplorer.addModule("yage.resource.material");

	explorer.packageExplorer.addModule("yage.resource.model");

	explorer.packageExplorer.addModule("yage.resource.resource");

	explorer.packageExplorer.addModule("yage.resource.shader");

	explorer.packageExplorer.addModule("yage.resource.sound");

	explorer.packageExplorer.addModule("yage.resource.texture");

	explorer.packageExplorer.addModule("yage.scene.all");

	explorer.packageExplorer.addModule("yage.scene.camera");

	explorer.packageExplorer.addModule("yage.scene.graph");

	explorer.packageExplorer.addModule("yage.scene.light");

	explorer.packageExplorer.addModule("yage.scene.model");

	explorer.packageExplorer.addModule("yage.scene.movable");

	explorer.packageExplorer.addModule("yage.scene.node");

	explorer.packageExplorer.addModule("yage.scene.scene");

	explorer.packageExplorer.addModule("yage.scene.sound");

	explorer.packageExplorer.addModule("yage.scene.sprite");

	explorer.packageExplorer.addModule("yage.scene.terrain");

	explorer.packageExplorer.addModule("yage.scene.visible");

	explorer.packageExplorer.addModule("yage.system.all");

	explorer.packageExplorer.addModule("yage.system.graphics.all");

	explorer.packageExplorer.addModule("yage.system.graphics.api.api");

	explorer.packageExplorer.addModule("yage.system.graphics.api.opengl");

	explorer.packageExplorer.addModule("yage.system.graphics.probe");

	explorer.packageExplorer.addModule("yage.system.graphics.render");

	explorer.packageExplorer.addModule("yage.system.input");

	explorer.packageExplorer.addModule("yage.system.log");

	explorer.packageExplorer.addModule("yage.system.sound.all");

	explorer.packageExplorer.addModule("yage.system.sound.openal");

	explorer.packageExplorer.addModule("yage.system.sound.soundsystem");

	explorer.packageExplorer.addModule("yage.system.system");

	explorer.packageExplorer.addModule("yage.system.window");
</script>
  </body>
</html>

